

## 第一章	概述

### 1.速率相关性能指标

#### 1.1 速率

定义：连接在计算机网络上的主机在数字信道上传送数据位数的速率
单位:   b/s,Kb/s,Mb/s,Tb/s，如果用字节表示，则是B/s,KB/s,MB/s,TB/s    1Byte=8Bit

#### 1.2 带宽

在计算机网络中，指的是网络设备所支持的最高速度，单位同速率，是理想条件下最高速率

#### 1.3 吞吐量

指的是单位时间内通过某个网络的数据总量

个人理解
速率就是实际网速，带宽是理论网速（长城宽带警告），吞吐量是一个或多个设备的综合速率，比如说1000m宽带的路由器连着三部手机，每部手机都是10mb/s看片，那么速率就是10mb/s，带宽是宽带的1000m，路由器吞吐量是30mb/s，即三者之和

### 2.时延相关指标

#### 2.1 时延

时延包括四大类

| 名称   | 描述                 | 计算公式              |
| ---- | ------------------ | ----------------- |
| 发送时延 | 数据从主机到信道上所用的时间     | 发送的数据长度/发送速率      |
| 传播时延 | 数据在信道上传播所花费的时间     | 信道长度/电磁波在信道上传播的速率 |
| 排队时延 | 数据在路由器前等待前面数据处理的时间 | 无计算方式             |
| 处理时延 | 数据在路由器中处理需求的时间     | 无计算方式             |

使用高速链路(提高网速)，只能减小发送时延，无法减少其他三个时延

#### 2.2 时延带宽积

公式：时延带宽积=传播时延x带宽
意思是链路上有多少比特的数据

#### 2.3往返时延RTT

发送端发送数据开始，到发送端收到来自接收端的确认（接收端收到数据后便立即发送确认），总共经历的时延
RTT=传播时延x2+处理时间(有时可能直接忽略)

#### 2.4 利用率

##### 2.4.1 信道利用率

信道利用率=有数据通过时间/（有数据通过时间+无数据通过时间）

##### 2.4.2 网络利用率

网络利用率=所有信道利用率加权求平均值

##### 2.4.3 时延和利用率的关系图

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626203643244.png)

​												利用率越高，延迟越大

### 3.分层结构

#### 3.1 为什么要分层，分层要做什么

（1）发起通信的计算机必须将数据通信的通路进行激活。
（2）要告诉网络如何识别目的主机。
（3）发起通信的计算机要查明目的主机是否开机，并且与网络连接正常。
（4）发起通信的计算机要弄清楚，对方计算机中文件管理程序是否已经做好准备工作。
（5）确保差错和意外可以解决。

#### 3.2 正式认识分层结构

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626204724293.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 4.参考模型

| 名称    | 英文                 | 作用                                       |
| ----- | :----------------- | ---------------------------------------- |
| 应用层   | Application Layer  | 直接为用户的应用进程（例如电子邮件、文件传输和终端仿真）提供服务。如HTTP、SMTP、FTP、DNS等 |
| 表示层   | Presentation Layer | 把数据转换为能与接收者的系统格式兼容并适合传输的格式，即让两个系统可以交换信息  |
| 会话层   | Session Layer      | 负责在数据传输中设置和维护计算机网络中两台计算机之间的通信连接          |
| 传输层   | Transport Layer    | 负责端到端通讯，可靠传输，不可靠传输 ，流量控制，复用分用            |
| 网络层   | Network Layer      | 负责选择路由最佳路径，规划IP地址(ipv4和ipv6变化只会影响网络层)，拥塞控制 |
| 数据链路层 | Data Link Layer    | 帧的开始和结束，还有透明传输，差错校验(纠错由传输层解决)            |
| 物理层   | Physical Layer     | 定义网络设备接口标准，电气标准(电压)，如何在物理链路上传输的更快        |

#### 4.1OSI流程简介

网络层及以上，每一层都要对上一层发送的数据进行处理（加个头部）
数据链路层不仅需要加头部，还需要加尾部
物理层什么都不加，只管发送数据（比特流）

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626205152756.png?xshadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 4.2 TCP/IP参考模型

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626205911885.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 4.3 五层参考模型及其传输过程简介

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626210125977.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626210211625.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

## 第二章	物理层

### 1.基本概念

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626212252286.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 2.数据通信基本知识

#### 2.1一个数据通信例子

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626212614182.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 2.2相关术语

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626212816152.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 2.3三种通讯方式

| 名称    | 英文          | 定义                   | 需要信道条数 |
| ----- | ----------- | -------------------- | ------ |
| 单工通信  | Simplex     | 只能一个发一个收             | 一条     |
| 半双工通信 | half-duplex | 都可以发或者收，但是同一时间只能进行一个 | 两条     |
| 全双工通信 | duplex      | 都可以同时收发数据            | 两条     |

#### 2.4两种数据传输方式

| 传输方式 | 特点           |
| ---- | ------------ |
| 串行传输 | 速度慢，省钱，适合远距离 |
| 并行传输 | 速度快，耗钱，适合近距离 |

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626213810764.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 2.5码元（Symbol）

定义：码元是指用一个固定时长的信号波形（数字脉冲），代表离散数值的基本波形。当有多个离散状态时，成为M进制码元
一个码元可以携带多个比特的信息
个人理解：码元就是在网线上传输的一个个信号段。码元的不同进制就是用来表示不同的数值的

#### 2.6 波特（Baud）

用来指一秒可以传输多少个码元

#### 2.7 速率

分为码元传输速率和信息传输速率
信息传输速率就是b/s，就是我们平常说的网速
码元可以理解为几个比特的集合，所以信息传输速率（网速）=码元传输速率x码元所带信息量（多少比特）
码元所带信息量（比特数）=log2（码元进制数）

#### 2.8 带宽（Band Width）

用来表示最高数据速率

#### 2.9 奈式准则（Nyquist）

是在理想状态下得出的结论

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626222053679.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 2.10 香农公式（Shannon）

是在**有噪声的信道中**得出的结论

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626225409541.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626225547833.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 2.11 基带信号和宽带/带通信号（Base band，pass band）

计算机网络中用的基带信号是**数字信号**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626225921565.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 2.12 编码

将数据转化为**数字信号**
数字数据(digtal data)通过 数字发送器(digit emitter) 转化为 数字信号(digtal signal)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626154459852.png)

模拟数据(analog data)通过 PCM编码器(PCM coder) 转化为 数字信号 (digtal signal)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626154431937.png)

```
单极性不归零编码：只使用一个电压值，高电平表示1，低电平表示0.
性不归零编码：用幅值相等的正负电平表示二进制数1和0.
单极性归零编码：发送码1时高电平在整个码元期间只持续一段时间，其余时间返回零电平。
双极性归零编码：正负零三个电平，信号本身携带同步信息。
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626163610563.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

```
曼彻斯特编码：单极性编码的缺点是没有办法区分此时是没有信号，还是有信号，但是信号是0.
这种编码方式是bit中间有信号，低-高跳转表示0，高-低跳转表示1，一个时钟周期只可以表示一个bit，并且必须通过两次采样才能得到一个bit。它能携带时钟信号，而且能区分此时是没有信号还是信号为0.
```

```
差分曼彻斯特编码：抗干扰能力比曼彻斯特编码更强。bit与bit之间有信号跳变，表示下一个bit为0，bit与bit之间没有信号跳变，表示下一个bit为1。
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626165018277.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 2.13 调制：数据转化为模拟信号（了解）

常用的调制方法：调频(AM)，调频(FM)，调相(PM)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626165059865.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

模拟数据(analog data)通过 调制器(modulaotr) 转化为 模拟信号 (analog signal)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626154409879.png)

数字数据(digtal data)通过 调制器(modulaotr) 转化为 模拟信号 (analog signal)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626154455793.png)

### 3.物理层传输介质

传输介质分为导向性传输介质和非导向性传输介质

| 导向性传输介质  | 电磁波沿着固定媒介（铜线or光线）被导向传播 |
| -------- | ---------------------- |
| 非导向性传输介质 | 自由空间，如空气，水等等           |

#### 3.1常见的导向性传输介质

##### 3.1.1双绞线

根据有无屏蔽层分为**屏蔽双绞线（STP）和无屏蔽双绞线（UTP）**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627110148375.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.1.2 同轴电缆（Coaxial Cable）

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627110353962.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.1.3 光纤（Optical fiber）

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627110509407.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

根据**入射角**不同，又分为单模光纤和多模光纤

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627110700437.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 3.2 常见的非导向性传输介质

包括**无线电波**，**微波**，**红外线**和**激光**等

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627110843264.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 4.物理层设备

#### 4.1 中继器（RP repeater）

注释：5-4-3规则是为了限制中继器使用次数的，理由可见图
5是指不能超过5个网段
4是指在这些网段中的物理层网络设备（中继器，集线器）最多不超过4个
3是指这些网段中最多只有三个网段挂有计算机

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627111139163.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 4.2 集线器（Hub）

集线器是个大的冲突域，同时**只能有两个设备进行通讯**，只会传输信号，没有智能。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627111545392.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 5.本章思维导图

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627112018411.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

## 第三章	数据链路层

### 1. 基本概念

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627112630722.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 2. 封装成帧与透明传输

**封装成帧**就是加将数据加头加尾，相当于将数据打包
**透明传输**就是为了防止**特殊的数据无法正常传输**的的情况的发生，比如说在封装成帧的过程中出现数据中的某些标记符与开始/结束标记符恰巧重复等等情况

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627121353485.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627121943191.png)

##### 2.1 透明传输的应用

##### 2.1.1 字符计数法

就是在帧的首部做计数，看看数据是否错误
缺点：如果在某一个帧内，标记位后面的某个字节的数据丢失，那么会影响后面的帧
比如3 1 1 和 4 2 2 2，如果前面的帧丢失变成 3 1，那么后面的4就会被补到前面变成 3 1 4导致错误

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627122122260.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 2.1.2 字符填充法

就是加头加尾分别标记开始结束，和零比特填充法（见下）对比，**开始和结束的对应的字符不一样**
但有可能出现数据内某段比特流数据正好**与标记字段重复**，从而导致误判断的情况

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627122415229.png?xshadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

解决方法：添加转义字符

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627122642435.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 2.1.3 零比特填充法

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627122934743.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 2.1.4 违规编码法

因为曼彻斯特编码不使用高-高，低-低来表示，所以如果使用高-高，低-低来表示帧起始和终止就**不会与数据冲突**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627123050151.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 3. 差错控制

#### 3.1 差错是什么，从哪来的

[数据链路层](https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82)的差错检测的是**比特**的错误

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062712365377.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 3.2 为什么要在数据链路层进行差错控制？

因为错误可以尽早发现，不会让一个错误的数据包发送了很长时间到达最终目的地之后才被发现，从而导致网络资源的浪费

#### 3.3 检错编码（奇偶校验码，循环冗余码CRC）

##### 3.3.1 奇偶校验码

缺点：只能检测出1，3，5，7…等等奇位数错误，检测成功率位50%

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627130921199.png)

##### 3.3.2 循环冗余码CRC

就是用传输数据除以生成多项式得到冗余码

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062713153254.png)

实际例子
注释：
1.阶数就是最高位是哪位，然后位数-1，如10011就是5-1=4,1011就是4-1=3
2.异或运算就是相同得0，不同得1，比如100和101做异或，结果就是001
3.出书和最后的余数添加到要发送的数据后面，称为**帧检验序列FCS**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627131633434.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

接收方收到数据后进行检测

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627132107709.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

需要注意的地方

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627132214691.png)

#### 3.4 纠错编码（海明码）

分为四步

**第一步 确认校验码位数r**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627132546766.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

**第二步 确定校验码和数据的位置**

注释：
1.为什么是10为数据位？因为4位校验码+6位信息位=10位
2.校验码放到2的几次方的位置，其他的地方按顺序放已知的信息位

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627132725336.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

**第三步 求出校验码的值**
注释
1.先是通过二进制位确定有几位。本题中因为最大位10的二进制是1010，所以是4为，将其标注
2.然后从p1开始看，看p1的二进制位的数值和所有信息位的对应位置的数值是否相同，然后找出来这些位
这里有点难理解，这里以p1为例辅助理解，这里找出来的就是P1,D1,D2,D4,D5![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627133356420.png)

然后计算异或值，比如说这里D1=1,D2=0,D4=1,D5=0,就是p1要同时和0,1，0,1进行异或之后得到0，为了标识我加粗原始计算数据
举例：0和1异或得1,1和0异或得1,1和1异或得0，那么p1和0异或得0，p1就是0了
3.其他同理，按顺序计算出P2,P3,P4,然后填入表格![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627133056623.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

**第四步 检测并纠错**

就是和上面一样，将所有校验位进行运算，得出的结果的值就是错误的位

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627134416184.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 4. 数据链路层的流量控制和可靠传输

#### 4.1 流量控制与可靠传输

流量控制是为了让传输过程中的发送速度和接受速度匹配，减少传输出错与资源浪费
可靠传输是发送端发送什么，接收端就要受到什么

##### 4.1.1 停止等待协议（Stop-and-Wait）

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627150624453.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

停止等待协议的**无差错**情况
注释：因为一次就一个，所以用0和1标记ack就行

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627150810912.png?xshadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

停止等待协议的**有差错**情况

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627151008798.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627151301222.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627151343650.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

停止等待协议的特点
1.简单
2.信道利用率低。大部分时间数据都在路上，发送方很长时间闲置，资源浪费

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627151529667.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627151615649.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 4.1.2 后退N帧协议（GBN）

因为停止等待协议太浪费时间了，所以尝试采用GBN，发送连续多个数据帧，以增大信道利用率
注释：
累计确认：就是收到一个确认帧，那么它和它之前的所有帧都默认已收到，反之，如果某个确认帧没收到，那么它和它之后的所有帧都默认丢失（即使收到了也丢掉），进行重传![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062715251276.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

下图是一个实例
注释：此图发送2帧时丢失，所以接收方几首收到后面的帧也是直接丢弃并且发送最晚收到的有效帧1的ACK，直至2帧的超时重传机制被触发进行重传并得到ACK之后，接收方才会接受2帧以及后面的帧

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627153111466.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

发送窗口不能无限大，与使用的编号的比特数有关
很简单，就是1比特编号0和1,同理2比特编号0-3，如果用1比特编号，却要4个窗口长度，那么窗口内数据编号都编不过来，直接乱套了
GBN的优缺点也显而易见，优点是提高了信道利用率，缺点是因为重传机制的原因导致已经收到数据却需要强行丢弃而造成浪费

##### 4.1.3 选择重传协议（SR）

为了解决GBN的缺点，我们打算尝试只重传错误的帧，这样的话就不用浪费资源吧已经收到的帧再重传一次了。
和GBN相比，两者都有窗口了，和GBN的区别其实就是做了一个数据缓存，已经收到的帧不用扔了，等待之前因意外丢失的帧收到的时候确认即可，但是只能缓存窗口尺寸内的包含的帧（PS，缓存咋可能无限大）
SR运行过程
注释：2帧丢失之后仍然在发送，但是2帧丢失之后只是缓存，并没有移动窗口，直至最后2帧收到后一次性确认2-5帧![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627155019851.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

同样的，因为编号的问题，发送窗口不能无限大
发送窗口最后和接受窗口**大小相同**，这样利用率比较高

### 5. 介质访问控制技术

就是让节点之间的通信不会进行相互干扰

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627160903721.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 5.1 信道划分介质访问控制

虽然使用一条共享信道，但是通过多路复用技术组合进行传输，提高了信道的利用率

##### 5.1.1 频分多路复用FDM

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062716134134.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.1.2 时分多路复用TDM

TDM的缺点就是利用率低，所以又衍生出了STDM

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627161416465.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.1.3 统计时分复用STDM

STDM的原则是先到先走，满了就发，相对于TDM提高了利用率

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627161525107.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.1.4 码分多路复用CDM

CDM只是做一下记录，暂时还用不到，有需要请自行查找资料

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627161726662.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 5.2 随机访问介质访问控制

所有用户都可以随机发送信息，发送时可以占用全部带宽，理论上个人使用时比静态分配信道的速度更快

##### 5.2.1 ALOHA协议

纯ALOHA协议缺点：太随性，导致效率低

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627162357969.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

时隙ALOHA协议
相对于纯ALOHA协议就是固定了发送的时间（只能在一个时间片的开始），提高了效率

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627162650471.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.2.2 CSMA协议

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627163031462.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

| 名称       | 描述                                       | 优点            | 缺点                   |
| -------- | ---------------------------------------- | ------------- | -------------------- |
| 1-坚持CSMA | 发送信息时监听信道，一空闲下来就立即传输，信道忙也一直监听，如果发送时冲突就等待随机时长之后再监听 | 立即发送，利用率高     | 如果多台设备同时监听，那么会发生冲突   |
| 非坚持CSMA  | 发送信息时监听信道，如果空闲就立即传输，信道忙就随机等待一段时间后再监听     | 冲突发生的几率减少     | 因为需要等待，所以利用率不高       |
| p-坚持CSMA | 发送信息时监听信道，空闲时以概率p进行传输，概率1-p不传输。信道忙就随机等待一段时间后再监听 | 冲突减少的同时效率也比较高 | 即使发生冲突也要坚持发送数据，资源被浪费 |

##### 5.2.3 CSMA/CD协议

**概述**

就是因为链路实际有长短，发送数据需要时间，这个时间内可能就被其他节点当成空闲状态导致发生碰撞
知道自己发生碰撞的最长时间是2τ（两倍的**传播时延**），就是一去一回

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627172333977.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

图示传播时延对载波监听的影响

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627181945643.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627183458233.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627182153577.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

由此我们可以想到最小帧长的问题，因为如果帧太短，帧都发送完了才检测到碰撞导致停止，导致无法停止碰撞

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062718350424.png?,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.2.4 CSMA/CA协议

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627184714796.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627184823659.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.2.5 CSMA/CD 与 CSMA/CA的区别

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062718532038.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.3 轮询访问介质访问控制

主要包括两大类，一个是轮询协议，另一个是令牌传递协议

##### 5.3.1 轮询协议

就是选出一个代表，让他控制所有的传输
注释：轮询开销在随着服务的节点越多，需要用于查询是否发送数据发送的数据帧也就越多，会造成一定开销等待延迟就是因为这是轮流“邀请”，所以难免某个节点需要发送数据，但是主节点还在较远的需要里有需求的节点那边，导致需求得不到立即响应。单点故障很好理解，就是代表挂了。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627190229529.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.3.2 令牌传递协议

注释：在节点之间没有收发数据的需求时，令牌在节点之间循环。
发送数据的流程
==》当一个节点需要时就可以获得这个令牌。然后修改这个令牌的状态（空闲->占用）
==》再将令牌与数据帧结合，让其在节点构成的环之间流动
==》不是目的地的节点收到令牌也不接受，直接略过，目标节点收到信息并复制一份到本地（传输完成），因为是个闭环，所以发送节点最后得到令牌
==》最后，发送令牌的节点对令牌的内容进行检查，如果发现数据出错还要重新发一遍
问题基本和轮询协议相同

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627205055826.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 6.局域网

#### 6.1 局域网的概念

概括：范围大小，速度快，延迟低，节点平等

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627210439299.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 6.1.1 局域网的网络拓扑结构

常用的是**总线型拓扑**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627210700283.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 6.1.2 局域网的传播介质

| 局域网   | 常用介质        |
| ----- | ----------- |
| 有限局域网 | 双绞线，同轴电缆，光线 |
| 无限局域网 | 电磁波         |

##### 6.1.3 局域网介质访问方法

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627210926529.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 6.2局域网的分类

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627211026206.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 6.3 IEEE802标准

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627211306397.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 6.3.1 IEEE802描述的局域网参考模型

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627211401404.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 6.4以太网

##### 6.4.1 以太网概念

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627211606200.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627211721247.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 6.4.2 以太网的发展

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627224030441.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 6.4.3 适配器和MAC地址

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627224149350.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)



##### 6.4.4 以太网MAC帧

注释：
1.这里的mac层指的是数据链路层
2.之前说过数据链路层将上一层ip数据包加头加尾
头就是目标地址（6字节），源地址（6字节），类型（2字节）
尾就是FCS（帧检验序列），（4字节）
3.前导码不是MAC帧的一部分，目的是使时钟同步
4.为什么数据长度时46~1500？
因为有最小传输字节64字节，mac占用6+6+2+4=18，所以数据最小为64-18=46，1500则是规定的默认最大字节，没有理由![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627224520210.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 6.4.5 10BASE-T以太网

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627225136362.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 6.4.6 高速以太网

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627224252903.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 6.5 无线局域网

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627230045240.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627230109894.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 6.5.1 两种无线局域网

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627230151259.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627230158897.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 7.广域网

#### 7.1 广域网的概述

概括一下，一个字大

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627230316639.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 7.2 PPP协议（Point-to-Point Protocol）

PPP协议是目前**使用最广泛**的数据链路层协议，拨号基本都是PPP协议
PPP协议**仅支持全双工**链路

##### 7.2.1 PPP协议需要满足的要求

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627230948785.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 7.2.2 PPP协议不需要满足的要求

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627230916385.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 7.2.3 PPP协议组成成分以及功能

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627231054259.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 7.2.4 PPP协议的帧格式

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062723121486.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 7.3 HDLC协议（High-Level Data Link Control）

##### 7.3.1 HDLC协议概述

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627231345512.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 7.3.2 HDLC的三种站

![在这里插入图片描述](https://img-blog.csdnimg.cn/202006272314286.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 7.3.3 HDLC的帧格式

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200627231635817.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 7.4 PPP协议和HDLC协议对比

为什么HDLC协议更可靠，但是我们使用PPP协议？
因为现在网络要求高，数据链路层本来就是不可靠的尽力传输，差错控制这些复杂的交给了TCP等

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062723171761.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 8.链路层设备

#### 8.1 集线器（Hub）

可以扩展以太网，但是集线器会无脑将一个设备的所有消息转发到集线器所连的所有设备，故会将所连接的所有设备变成一个大的冲突域，同时只能有两台设备进行通信，且设备越多，冲突越多。由此诞生了网桥

#### 8.2 网桥（Bridge）

使用网桥时，由于网桥会根据mac地址进行过滤，所以不会形成冲突域![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628000638789.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 8.2.1 两种网桥

**透明网桥**
通过自学习来构建转发表。每一个通过网桥的数据包都会被记录下网桥收到数据时数据对应的地址和网桥自己的接口，通过许许多多的数据包的构造的缓存，网桥就可以知道哪个数据包在哪个接口，以后如果要穿数据包就知道要往哪个接口发送数据包了

**原路由网桥**
在发送时，直接将最佳路径放到帧首部。那么网桥如何获得最佳路径？通过广播方式想目标地址发送广播，此时可能会经过不同路由产生不同的路径，目标地址收到后再将每一条路径都发一个响应帧给网桥，网桥经过对比就知道哪个接口最快了

#### 8.3 交换机

网桥接口越来越多，网桥就变成了交换机

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062800263617.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 8.4 冲突域和广播域

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628001124492.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 9. 本章总结思维导图

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628002730615.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

## 第四章 	网络层

### 1.概述

注释：
数据报和分组的关系：分组是一段比较长的数据，将它进行切割成一段段之后就得到数据报
功能一就是让数据在路由器之间走最佳的路径
功能二就是让不同的设备（手机，电脑，平板等）都能正常连接
功能三见图中解释
开环控制就是在拥塞之前就提前设计解决
闭环控制就是在拥塞时自动调整解决问题![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628100232914.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

| OSI参考模型 | 各层次的传输单元                  |
| ------- | ------------------------- |
| 应用层     | 报文                        |
| 传输层     | 报文段                       |
| 网络层     | IP数据报，分组（如果IP数据报太大就切割成分组） |
| 数据链路层   | 帧                         |
| 物理层     | 比特流                       |

### 2. 数据交换方式

为什么要进行数据交换？因为每个节点之间都拉网线太麻烦了也不实际，所以通过大量交换设备互联进行数据交换

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628101240749.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 2.1 电路交换

常见的例子：打电话
注释：
链路支持多路复用（可参考[数据链路层](https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82)的TDM等）
特点是独占资源，因为两者建立了连接

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628134105730.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 2.2 报文交换

注释：报文发送的过程
1.源先根据报文加上ip地址，物理地址等，通过物理层发送
2.交换机收到报文之后，先进行存储，等待链路空闲之后进行转发，但是转发的路径不是固定的，是比较随机的
3.最后通过许多交换机最终到达目的地

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628134558218.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 2.3 分组交换

分组交换和报文交换基本相同，就是将报文切割之后再进行发送

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628135456570.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 2.4 分组交换和报文交换的具体计算对比

注释：是怎么计算的？
报文交换：一共三段，每段都需要10000bit/1000bps=10s，三段就是3x10=30s
分组交换：可以分为两段，一个是第一个数据开始发到最后一个数据从源发出，一段是最后一个数据到达目的地。第一段总时间是10000bit/1000bps=10s，第二段总时间是（10/1000）*2=0.02s，所以总时间是10.02s。
理解一下，这里就是报文交换的时候，由于报文没有分割，所以即使先到的数据也不能先发走，只能等到最后一段报文全部到了之后才能一起走，相对于分组交换明显拖慢了前面数据的速度，所以导致报文交换明显慢于分组交换
可以看到分组交换明显快于报文交换，所以我们通常使用分组交换![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628140059520.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 2.4.1 分组传输的两种传输方式-数据报与虚电路

**综述**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628141302754.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628151011994.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

**数据报**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628150810177.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

**虚电路**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628150941414.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 3. 路由算法和路由协议概述

路由算法就是让路由知道收到报文之后下一步怎么走

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062815165630.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

AS就是多个路由器之间构成的单独的小圈子，圈子内使用自己的协议，圈子和圈子之间用的是BGP协议

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062815185760.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 3.1 RIP协议和距离向量算法

##### 3.1.1 RIP协议概述

通过交换信息构建路由表

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629105637285.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.1.2 如何建立路由表

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629105916914.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.1.3 RIP协议报文格式

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629111259211.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.1.4 RIP协议特点

就是来回更新路由表，错误信息被覆盖，导致直至达到距离上限强制错误时才可以得知出错

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629111526974.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629111637786.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)



![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629111700886.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.1.5 距离向量算法

注释：
为什么改地址？因为图中是从x得到的信息
为什么距离固定+1？因为路由器只从相邻路由器之间获取RIP报文，举例只会是1
为什么下一跳是x就要替换？因为网络环境不断变化，可能这次某个节点挂掉，所以保持最新的
为什么下一跳不是x时有更新和不处理两种手段？因为这样可以提高效率，比原来快就换，比原来慢就保留原来的，也可以理解

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629110232985.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062911085927.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629111155473.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 3.2 OSPF协议和链路状态算法

##### 3.2.1 OSPF协议概述

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629111933218.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.2.2 OSPF的其他特点

为什么OSPF收敛速度快？因为它只是刷新一下链路状态，得知其是否连通，不需要和RIP一样进行对照，而是直接通过Dijilstra算法来自己算出路径

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629115353647.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.2.3 链路状态路由算法

了解即可

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629115012290.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.2.4 OSPF区域

了解即可

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629115212801.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.2.5 OSPF分组

了解即可

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629115305114.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 3.3 BGP协议

##### 3.3.1 BGP协议简介

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629202605883.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.3.2 BGP协议交换信息的过程

了解即可，只需要知道BGP交换协议里面交换的是一组路径向量

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629203846439.png)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629202751648.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629202816442.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.3.3 BGP协议报文格式

BGP是应用层协议

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062920290996.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.3.4 BGP协议特点

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629203255760.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.3.5 BGP的四种报文

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629203720460.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 3.4 三种路由协议的比较

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629204214191.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629204241177.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 4. IP数据报

#### 4.1 IP数据报格式

注释：

| 名称                          | 注释                                       | 大小             |
| --------------------------- | ---------------------------------------- | -------------- |
| 版本 Version                  | ipv4或者ipv6                               | 4位             |
| 首部长度 IHL                    | 此处数值再乘以4才是真正大小，同时因为IP数据报固定长度为20字节，所以此处最小值为5，即二进制的0101 | 4位             |
| 区分服务 DSCP + ECN             | 希望获得哪种服务，用的比较少                           | 8位             |
| 总长度 Total Length            | 首部+数据的长度，最大为2^16-1=65535                 | 16位            |
| 标识 Identification           | 用来表示是哪一个数据报的分片，不同的分片标识各不相同               | 8位             |
| 标志 Flags                    | 用来表示是否分片和分片是否结束                          | 3位，但实际有用的只有后两位 |
| 片偏移 Fragment Offset         | 用来标记分片之后，该分片在原来的数据报的位置，以8字节为单位           | 13位            |
| 生存时间 Time To Live           | 即TTL，没经过一个路由器TTL-1,0时自动放弃，根据系统不同默认的TTL不同 | 8位             |
| 协议 Protocol                 | 用来标记协议名的字段值，如TCP,UDP,ICMP等等              | 8位             |
| 首部检验和 Header Checksum       | 检验首部的字段是否出错，出错就丢弃此数据报                    |                |
| 源地址 Source IP Address       | 发送方ip地址                                  | 32位            |
| 目的地址 Destination IP Address | 接收方ip地址                                  | 32位            |
| 可选字段 Options                | 用来排错等安全检测                                | 未知，可在0-40位之间   |
| 填充                          | 将数据报对齐成4字节的整数倍，数值全部为0                    | 未知，根据可选字段来定    |

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628163753975.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628163922707.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

计算偏移量时记住是以0开始的就行，以每一篇最开始的除以8得到的数值就是偏移量
MF和DF的定义见上图

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628164237523.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 5. IP

#### 5.1 ipv4地址

**全球唯一的**表示某一个主机或者路由器接口的编码

##### 5.1.1 ip地址分类

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628165300355.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.1.2 特殊ip地址

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062816534040.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.1.3 私有ip地址

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628165703918.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

解释一下
为什么A类最大是126.xxx.xxx.xxx？
因为网络号最开始第一位是0，一共八位，所以二进制表示位0xxxxxxx，最大就是2^7-1=127，但是因为127.xxx.xxx.xxx是特殊ip地址，所以将其去掉
为什么B类最大是191.255.xxx.xxx？
因为网络号最开始第一位是10，一共八位，所以二进制表示位10xxxxxx，最大就是10111111=191，最小就是10000000=128，无特殊ip地址
为什么C类最大是223.255.xxx.xxx？
因为网络号最开始第一位是110，一共八位，所以二进制表示位110xxxxx，最大就是11011111=223，最小就是10000000=192，无特殊ip地址

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628173140760.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 5.2 网络地址转换NAT

注释：连接内网和外网，就是找个代理的用它的ip地址与外面收发数据
NAT需要构建NAT转换表，既要存广域网（WAN，外网）也要存局域网（LAN，内网）的ip地址和端口号

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628203040212.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 5.3 子网划分和子网掩码

##### 5.3.1 为什么需要子网划分

总结一下，就是ip不够用，所以需要额外整个子网扩展ip

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628203445257.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

注释：
为什么子网好能全0或者全1：因为CIDR编址（可见下一段）
为什么主机号不能全0或者全1：因为全0代表本网络，全1代表广播分组

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628203628674.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.3.2 子网掩码

子网掩码就是用来和ip地址一起计算子网的地址的
方法就是讲子网掩码逐位写成二进制然后而原来ip地址进行与运算，就可以得到子网ip地址
因为255是11111111，所以如果写着255的话，ip地址和子网ip地址对应的地方的数值就相同

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628204154511.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

这道题可以看出来，即使子网掩码不同，相同ip地址对应的子网ip地址也可能相同
但是子网掩码不同，划分的子网数目不同
为什么划分的子网数目不同？或者说怎么算划分的子网位数目？
以255.255.192.0为例，255是11111111即八个1,192是11000000即2个1，一共是82+2=18个1，一共有32位地址，所以剩余有32-18=14位
以255.255.224.0为例，255是11111111即八个1,224是11100000即3个1，一共是82+3=19个1，一共有32位地址，所以剩余有32-19=13位![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628204442714.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

这道题先将255.255.252.0计算出一共有8+8+6=22位网络号位
所以就有32-22=10位主机号位
将180.80.77.55解析，可以知道在77部分某部分开始会用来表示主机号位
77的二进制是0100 1101，因为一共有22位网络号位，所以010011 （此处分开） 01，从这个01开始是主机号位。
所以用来表示子网ip地址的应该是180.80.76（010011 00）.xxx PS注意76括号内后两位二进制00
但是本体是发布广播地址，所以主机号全部都要是1

所以应该是180.80.79（010011 11）.255（11111111）注意79括号内后两位二进制11![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062821061359.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

注释：
1.这里特定主机路由就是指找特定的处理这里这个ip地址的路由
2.默认路由会将这个数据报发给另一个路由，直至找到对应的路由，或者TTL耗尽被丢弃

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628212251576.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 5.4 无分类编制CIDR

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628213057516.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

使用CIDR可以聚合网络
如图，通过缩短前缀，R1和R2就可以合并在206.1.0.0/16的子网下
但是这样转发表之中就会有多个匹配结果，所以我们使用**最长前缀匹配**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628214310460.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

最长前缀匹配就是在计算后符合同一子网的时候，选前缀越长的
这道题选B

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628214654941.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

因为本网络是192.168.5.0/24，就是192.168.5.（0000 0000）/24，将248写成二进制是11111 000，有五个1，所以前五位都可以作为子网的编号，剩下的三位就是用来分配子网内剩余的地址了，因为不能全0或者全1，所以还要减2

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628220204999.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 5.5 ARP协议

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020062822274549.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628222947367.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 5.6 DHCP协议

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628223418552.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)



#### 5.7 ICMP协议

##### 5.7.1 ICMP协议概述

ICMP，IGMP处于[网络层](https://so.csdn.net/so/search?q=%E7%BD%91%E7%BB%9C%E5%B1%82)和传输层之间，就是为了更好地转发ip数据报和提高交互成功的几率

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200628223751853.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.7.2 ICMP差错报告报文

**ICMP差错报告报文如何与IP数据报结合**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629094024680.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

**五种ICMP差错报文**

其中源点抑制已废弃不用

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629083834897.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

**四种不发送ICMP差错报文的情况**

注释：组播是指由一点到多点，但不是无脑发到所有点，无脑发到所有点的是广播，组播有筛选条件

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629094235772.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.7.3 ICMP询问报文

**四种ICMP询问报文**

后两种是掩码地址请求和回答报文，路由器询问和通告报文，这两个已经废弃不再使用

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629094521489.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.7.4 ICMP的应用

1.ping命令：测试两个主机之间连通性，使用了**ICMP回送请求和回答报文**
2.traceroute命令：跟踪一个分组从原点到终点的路径，使用了**ICMP时间超过差错报告报文**
[traceroute命令讲解](https://blog.csdn.net/llq_200/article/details/81034345)

### 6. IPV6

#### 6.1 为什么会有IPV6

就是IPV4地址用完了，从根本上增加ip地址数目，之前讲的NAT和CIDR也只是在IPV4的基础上扩展了IPV4地址数目，治标不治本

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629095311686.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 6.2 IPV6地址表示形式

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629102621942.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 6.3 IPV6数据报格式

| 名称                       | 作用                                       | 位数   |
| ------------------------ | ---------------------------------------- | ---- |
| 版本 Version               | 知名协议版本，此处因为是ipv6所以总是6                    | 4位   |
| 优先级 Traffic Class        | 又来区分数据报的类型和优先级                           | 8位   |
| 流标签 Flow Label           | 和ipv4标识某个数据报分片不同，这是对于一整个数据报流的标记          | 19位  |
| 有效载荷长度 Payload Length    | 指的是扩展首部+数据部分的大小，和ipv4的总长度和首部长度都不同，ipv6的首部长度是固定的40字节 | 16位  |
| 下一个首部 Next Header        | 基本首部的下一个首部指的是有效载荷里标记的的扩展首部，有效载荷里的扩展首部再指向有效载荷里标记的的扩展首部，直至最后指向数据 | 8位   |
| 跳数限制 Hop Limit           | 基本相当于ipv4当中的TTL，每到一个路由器-1.减到0时丢弃         | 7位   |
| 源地址 Source Address       | 发送方ipv6地址                                | 128位 |
| 目标地址 Destination Address | 接收方ipv6地址                                | 28位  |

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629095626140.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 6.4 IPV4和IPV6的区别

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629102457217.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 6.5 IPV6基本地址类型

| 名称   | 作用                       | 要求         |
| ---- | ------------------------ | ---------- |
| 单播   | 一对一通信                    | 可做源地址，目的地址 |
| 多播   | 一对多通信，以前的广播地址当做覆盖所有主机的多播 | 可做目的地址     |
| 任播   | 一对多当中的一个通信，看似一对多，实则一对一   | 可做目的地址     |

#### 6.6 IPV4和IPV6之间的过渡

如果是ipv6的数据报到了ipv4，就用ipv4重新封装，把ipv6数据报前面加上ipv4伪装成ipv4数据报继续传输，直至到了ipv6路由再解开ipv4伪装

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629103250467.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 7. IP组播（多播）

#### 7.1 什么是组播

单播只能一对一，广播必须一对全部，组播就可以是一对全部中的一部分

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629205037734.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

辅助理解：单播所占资源多

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629210027661.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

组播明显减轻了压力

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629210108353.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 7.2 IP组播地址

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629210330405.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 7.3 硬件组播

就像全F的mac地址代表广播一样，00-10-5E打头的MAC地址就代表组播
7为什么最大是00-10-5E-7F-FF-FF？因为只有最后23位决定

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629210827844.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 7.4 IGMP协议与组播路由选择协议

##### 7.4.1 IGMP协议

注释：IGMP只能知道有没有组播组成员，对有几个组播组成员，成员在哪个地方都不知道

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629211352630.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629211613284.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 7.4.2 组播路由选择协议

有了这个，成员可以自行找到转发组，自行决定参加哪个组播（就像电视机选台一样）

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629211740525.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629211913501.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 8. 移动IP

移动IP**不等于**动态IP（DHCP获得的）
移动IP的可以让用户因为地理原因等等，即使不在内网也可以访问内网的东西

#### 8.1 移动IP的相关术语

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629212218336.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 8.2移动IP通信过程

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629212604875.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629220550874.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 9. 网络层设备

#### 9.1 路由器

##### 9.1.1 路由器的构造

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629220712123.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 9.1.2 路由器的输入输出端口构造

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629221015438.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629221022561.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 9.1.3 集线器，网桥，路由表几层设备比较

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629221130818.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 9.1.4 路由器的路由表和转发表

这里实际上就是对前面知识的复习了

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629221253590.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 10. 本章思维导图

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200629221414448.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

## 第五章	传输层

### 1. 概述

#### 1.1 传输层的意义

[网络层](https://so.csdn.net/so/search?q=%E7%BD%91%E7%BB%9C%E5%B1%82)可以把数据从一个主机传送到另一个主机，但是没有和进程建立联系。传输层就是讲进程和收到的数据联系到一起，使数据能够为应用服务所以说传输层是主机才有的层次

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630094441510.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 1.2 传输层的两个协议

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630094727731.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 1.3 传输层的寻址和端口

端口号只用于计算机分辨本地进程，总共有2^16=65536种端口号，端口号有很多种，不能随便使用

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630095024127.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 1.3.1 常见的应用程序端口号

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630095258962.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)



### 2. [UDP](https://so.csdn.net/so/search?q=UDP)协议

#### 2.1 UDP概述

注释：
因为UDP一次发送一个完整报文不会分片，所以需要应用层传输过来的数据不要太大，否则网络层分片任务就很重，但是也不能太小，不然效率较低
UDP适合一些实时应用，因为实时应用延迟要求高，需要立即响应

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630095616466.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 2.2 UDP首部格式

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020063010003161.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 2.2.1 UDP的校验位构成

这里的伪首部只是用来计算检验和的，计算完了就丢弃，可以见下UDP的校验方式

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630105441329.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 2.2.2 UDP校验方式

总结一下步骤：

**在发送端的时候：**
1.就是将每一行（4字节）拆成两部分，左右平均2字节大小，将这两字节数据写成二进制，那么2字节一共就需要2*8=16位。此时检验和没有计算，默认填充0，同时如果数据字段不整齐，则用0补齐，这样就可以写出几十行二进制数，如图中方所示
2.计算着几十行二进制数按二进制反码运算求和，二进制反码运算可以参考
二进制反码求和运算
得到的最后简介再反码，之后将反码之后的放入原来的检验和字段

**在接收端的时候**
与发送端的时候不同的是，此时检验和字段不是0了
按照发送端的步骤再将所有数据写成二进制进行二进制反码运算求和
如果最后得到结果全1就是没问题，否则丢弃

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630105526400.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 3. TCP协议

#### 3.1 TCP协议的特点

TCP必须要建立连接之后才可以进行数据交换，所以TCP是面向连接的

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630194247441.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

TCP传输数据是随机切割数据的

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020063020421472.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 3.2 TCP报文段的首部

注释：
见上图，可以看到TCP是将数据随机分割后加上TCP头传输的，所以
序号就是为了标记这些随机分割之后的数据，这里把第一个字节的编号当成序号
确认号就是收到之后做一下标记，代表这之前的都收到了，希望收到的下一个编号的数据就是确认号打头的那个数据
偏移量就是为了标记一下距离TCP开始多少字节是数据，这里的单位是4B，这个偏移量就是TCP首部长

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630210441410.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

窗口就是接收方告诉发送方，还有多少地方（缓存）可以放数据
紧急指针就是告诉TCP从哪里到哪里是紧急数据

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630212601599.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.2.1 TCP的六个控制位

**紧急位URG**

URG的特点就是让数据**插队**，URG=1的就会在缓存中被提前到第一个传输

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630211126589.png)



![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630211151331.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

**确认位ACK**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630211354251.png)

**推送为PSH**

就是接收端的URG，将PSH=1的数据尽快接收
注意一下，如果没有PSH，一般都是接收方缓存满了之后再将数据发送到主机

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630212045298.png)

**复位RST**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630212049447.png)

**同步位SYN**

A和B主机要建立连接，就A先发一个报文，其中SYN=1
B收到之后也回复一个SYN=1的报文，代表接受连接

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630212152221.png)

**终止位FIN**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630212056958.png)

#### 3.3 TCP连接管理

##### 3.3.1 TCP三次握手（建立连接）

注释：
第一段的意思是
SYN=1：(A)要建立连接了！
seq=x（随机）：因为还没有数据，所以写什么都无所谓

第二段的意思是
SYN=1：我(B)同意你(A)建立连接！
ACK=1：连接建立了，之后的ACK必须都置为1
seq=y（随机）：因为还没有数据，所以写什么都无所谓
ack=x+1：之前发送方(A)说发送的是第x位数据（虽然发送方是瞎说的），所以我(B)要的是x+1位数据

第三段的意思是
SYN=0：SYN只有在建立连接时才为1，其他时候均设为0
ACK=1：连接建立了，之后的ACK必须都置为1
seq=x+1：我(A)发送的报文段的第一个字节就是x+1
ack=y+1：之前接收方(B)说发送的是第y位数据（虽然接收方是瞎说的），所以我(A)要的是y+1位数据

注意一下，TCP是双向的，所以不存在绝对不变的发送方接收方，这里的两台主机都同时是发送方和接收方

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630213814996.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

**TCP三次握手特定导致的SYN洪泛攻击**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630214925395.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.3.2 TCP四次挥手（连接释放）

注释：
第一段的意思是
FIN=1：(A)要释放连接了！
seq=u：发了好多数据，这里只是用u指代一下，这里u是有确定值的

第二段的意思是
ACK=1：连接建立了，之后的ACK必须都置为1
seq=v：发了好多数据，这里只是用v指代一下，这里v是有确定值的
ack=u+1：之前发送方(A)说发送的是第u位数据，所以我(B)要的是u+1位数据（尽管此时A已经决定释放连接了）

第三段的意思是
FIN=1：(B)要释放连接了！
ACK=1：连接建立了，之后的ACK必须都置为1
seq=w：发了好多数据，这里只是用w指代一下，这里w是有确定值的
ack=u+1：之前发送方(A)说发送的是第u位数据，所以我(B)要的是u+1位数据（因为A直接不发数据了，所以第二段第三段的ack都是u+1）

第四段的意思是
ACK=1：连接建立了，之后的ACK必须都置为1
seq=u+1：之前发的数据时第u位数据，B也要第u+1位数据，所以我发第u+1位数据
ack=w+1：之前发送方(B)说发送的是第w位数据，所以我(A)要的是w+1位数据

为什么需要等待计时2MSL？
因为这样可以保证B可以收到A的终止报文段进而进入关闭状态
比如说如果A的第四段报文丢失，那么等待一个MSL之后B就会重传第三段报文，花费小于1MSL之后A就会再收到第三段报文，之后就可以再次向B发送第四段报文提示B关闭连接![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630215522825.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 3.4 TCP可靠传输

TCP是提供可靠传输，UDP这种本身还是不可靠传输的就再靠应用层解决了

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630220542461.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.4.1 序号

就是TCP根据下方数据链路层的MTU（最大传输单元）来随即将数据切割成好几端并且进行编号

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630221424853.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.4.2 确认

发送方每一次发送数据之后都需要接收方进行确认。
TCP使用的是累计确认机制，就是从第一个丢失的字节开始请求丢失的报文段。如图中456丢失，78到达，但仍然请求发送的数据序号是4

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630221636424.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.4.3 重传

为什么要使用自适应算法？网络环境太复杂，路径又长又短，RTT设置短了照顾不了距离远的，RTT设置长了又导致网络利用率降低，所以使用RTTs

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630222205619.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 3.5 TCP流量控制

简单来说就是接收方可以动态的发送信息告诉发送方发送窗口的大小。
接收方接受不过来了就让发送方发送窗口小点，这样发送方发送的速率就慢下来了，接收方就有时间处理它的数据了
接受方处理完了也可以发送请求让发送方发送窗口大点，这样发送方发送的速率就快起来了，接收方就可以处理更多数据而不是空闲等着收数据了![在这里插入图片描述](https://img-blog.csdnimg.cn/202006302226272.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.5.1 计时器

在本例子中，使用的累计确认机制（一次回复收到ack=201）和三次流量控制机制。
但是有一个情况就是，如果最后B不允许A再发送数据了，B在处理完数据之后想要恢复窗口大小时发送的有rwnd大小的数据报丢了怎么办？此时A有B的指令在前，发送窗口为0无法发送数据，B也在等待A回复，造成了类似死锁的现象
解决方法：使用计时器

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630223616929.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 3.6 TCP拥塞控制

流量控制是对单独一个来说的，拥塞控制是一群

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630224242515.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.6.1 拥塞控制四种算法

这里虽然是四种算法，但是通常是两两结合进行使用

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630232411944.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 3.6.2 慢开始和拥塞避免

这里开始时以指数形式增长，ssthresh的意思是慢开始门限，代表从这个地方注入的报文段就比较多了，需要开始慢速增加了。
之后一段都是线性增长，每次增加1，直至达到网络拥塞状态
瞬间将cwnd设置为1，同时调整原来的ssthresh的值到之前达到网络拥塞状态的1/2,（这里是24降到12）
重复以上步骤，但是注意此时ssthresh变了之后线性增长的转折点也变了

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630232910475.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

**3.6.3 快重传和快恢复**
这里和上面的慢开始和拥塞避免的一开始步骤差不多，都是先指数增长再转变为线性增长。
不同的点是快重传和快恢复算法是在收到连续的ack确认之后执行，这里的ack就是冗余ack，冗余ack的特点是如果多次对某一段请求的数据没有被收到，达到一定数目之后就会立即执行重传。但是此时只是降到现在cwnd的一半，再重新线性增长。而不是像慢开始和拥塞避免的从头开始![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630233701386.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 4. 本章思维导图

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200630234217765.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

## 第六章	应用层

### 1. 概述

因为不同的网络应用之间需要有一个确定的通信规则

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200702215803534.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 1.1 两种常用的网络应用模型

##### 1.1.1 客户/服务器模型（Client/Server）

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200702220439646.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 1.1.2 P2P模型（Peer-to-Peer）

网络健壮性指的是P2P模型不容易坏掉，即使一个节点坏了也没问题，可以有其他节点代替

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200702220544850.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 2. 域名系统协议（DNS）

#### 2.1 概述

DNS就是将打在地址栏的域名转化为IP地址的东西

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200702220920296.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)



##### 2.1.1 域名

域名就是www.xxx.com，当然这是最简单的一种
.com之后还可以有东西，称之为根
域名从左向右，级别逐渐增高

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200702221601437.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200702221626114.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 2.2 域名服务器（DNS服务器）

DNS服务器有很多台，根据层次结构分为三层，根域名服务器，顶级域名服务器，权限域名服务器
本地域名服务器不算层次结构，特点是里主机比较近，当主机和另一台比较近的主机通信时，就不用走哪些更高级的服务器了
根域名服务器并不是一个域名只有一台，而是一个域名对应多台域名服务器，全世界一共有13个这样的域名，分别是a.rootservers.net，b.rootservers.net，c.rootservers.net，~m.rootservers.net
在权限域名服务器中，虽然看似abc.com比y.abc.com少了一位，但是他们的地位仍是对等的，对应的两台权限域名服务器

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200702222254726.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 2.3 域名解析过程

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200702223128655.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200702223220720.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 2.3.1 递归查询

在上图中
主机先是想本地域名服务器发送请求，如果查不到的话，
本地域名服务器向根域名服务器发送请求（找别人），如果还是查不到的话，
根域名域名服务器向顶级域名服务器发送请求（找别人），如果还是查不到的话，
顶级域名服务器向权限域名服务器发送请求（找别人）
可以看到每一次向下一个查询的服务器都变了，不是主机一个个去问，而是服务器自己一个个问下去

##### 2.3.2 迭代查询

在上图中
主机先是想本地域名服务器发送请求，如果查不到的话，
本地域名服务器就让主机去向根域名服务器发送请求（主机去找，本地域名给目标根域名服务器的IP地址），如果还是查不到的话，
根域名域名服务器让主机去向对应的顶级域名服务器发送请求（主机去找，根域名给目标顶级域名服务器的IP地址），如果还是查不到的话，
顶级域名服务器让主机去向权限域名服务器发送请求（主机去找，顶级域名给目标权限域名服务器的IP地址）
可以看到这里是主机一个个挨个问的地址

##### 2.3.3 高速缓存

为了减少多次查询同一个域名的资源浪费，本地域名服务器会存储最近使用的ip地址解析，下次再访问同一个域名就不需要这么多查询步骤了。同时这个高速缓存主机本身也有存储
同时本地域名服务器还可以对顶级域名服务器，权限域名服务器的地址进行缓存，下一次即使是不知道的ip地址，查询也可以更快
高速缓存为了保持正确性，需要定时更新

### 3.文件传输协议（FTP，TFTP）

#### 3.1 概述

TFTP是一个轻量的，比较容易实现的，面对小文件的，UDP的文件传输协议

这里我们重点是FTP协议

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200702224616787.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 3.2 FTP的服务端和客户端

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200702224816512.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 3.3 FTP的工作原理

为什么有匿名登陆：对于一些公共服务器来说，增加验证阶段就是增加资源开销，减少验证阶段就可以节省资源来更好地服务
主进程和从属进程的区别：主进程是打开端口，让外部发送的数据可以进来，并且将这些数据逐个分配各从属进程。从属进程则是单独为这些数据服务

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200702225039138.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703000333330.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

先注释一下这里的主进程被忽略掉了，只是没标在上面，不是没有啊
这里客户端和服务器端先建立TCP连接，端口是21，称为控制连接
然后看情况是主动建立连接还是被动建立连接
主动建立连接是指服务器端主动发送请求和客户端进行连接，此时端口号固定是20
被动连接是指客户端发送请求和服务器端建立数据传送连接，此时端口号是不确定，有两者协商得到
数据传输完成之后，数据连接断开，控制连接继续保持，直至两边发送断开请求![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703000401174.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

FTP的两种传输模式了解即可

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703000905460.png)

### 4. 电子邮件

#### 4.1 概述

##### 4.1.1 电子邮件的格式

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703001117831.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

**4.1.2 电子邮件系统的组成结构**
注释：
用户代理的四个功能解释：
撰写就是给用户编辑信件的环境
显示就是可以看到自己写的和自己收的信件内容
处理就是对信件进行操作，包括删除，打印，转发等等
通信就是可以将邮件发送到邮件服务器当中，同时可以从邮件服务器当中读取邮件

邮件服务器的功能注释
邮件服务器端的发送和接受是指从自己的用户代理处接收邮件，之后向对面的邮件服务器发送邮件
邮件服务器的报告邮件发送结果就是投递是否成功这种情况
邮件服务器既可以作为客户端又可以作为服务器端，使用的是C/S方式

协议的功能注释
发邮件用的是SMTP
收邮件的是POP3或者IMAP

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703001436566.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703002119799.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 4.2 几个邮件协议

##### 4.2.1 简单邮件传送协议SMTP

注意一下，这里STMP客户和服务器不是固定死的，可以也可以成为服务器，服务器也可以成为用户，由发送方和接收方决定，发送方就是客户，接收方就是服务器

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703002319315.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

注释
可以看见这里比如

```
220 service ready
250 OK
421 service not available
550 xxx
354 xxx
```

都是应答信息

这里RCPT能有多条命令的原因是，电子邮件可以有多个收件人，就是群发，所以允许多个RCPT

**再强调一下，这里服务器和客户端可以互换，视具体情况而定，发送方是客户端，接收方是服务器端**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703002844133.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 4.2.2 改进SMTP缺点的MIME协议

MIME改善SMTP发送数据的缺点，是SMTP的功能性扩展
MIME协议已经逐渐开始应用到浏览器当中，通过对不同文件类型用不同的标识符标识，来让浏览器读取通过MIME的相关文件

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703003639358.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 4.2.3 邮局协议POP3

这里接收方是客户端，邮件服务器是服务器端
POP3确实很简单，但是有不少缺点，比较难受的就是邮件一旦下载就自动删除了

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703003942969.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 4.2.4 比较复杂的读取邮件的协议——IMAP协议

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703004334235.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 4.3 基于万维网的电子邮件

与之前的不同的地方就是，基于万维网的电子邮件的**邮件服务器端可以不同**

同时，发送邮件使用的SMTP/MIME和收邮件时的POP3/IMAP协议都**换成了HTTP协议**

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020070300482031.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 5. 万维网和HTTP协议

#### 5.1 万维网概述

URL用来标识整个互联网当中的某一个资源（文字，视屏，音频等）的位置

HTTP用来将这些资源传送给用户

HTML帮助设计者来设计页面，让不同设计者设计的页面都可以在界面上显示

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703005114701.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

#### 5.2 HTTP协议

##### 5.2.1 HTTP协议的过程

这张图里讲了HTTP的具体过程

服务器通过TCP 80端口来监听HTTP请求

注意HTTP可以不一次性下载完页面的所有资源，可以只下载文本部分，其他音频视频等待用户下一步请求之后再传输

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703005650472.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.2.2 HTTP协议的特点

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703010043691.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

##### 5.2.3 HTTP的连接方式——持久连接和非持久连接

非持久连接在TCP三次握手的第三次握手时发生，将HTTP请求作为第三次握手的数据部分发给服务器，服务器收到请求之后将HTTP相应报文传输给客户。耗时就是RTT*2+文档传输时间。
缺点就是这样如果再想传输，那么就需要重新建立TCP连接从头开始

持久连接和非持久连接类似，都是在第三次握手时发生，将HTTP请求作为第三次握手的数据部分发给服务器，服务器收到请求之后将HTTP相应报文传输给客户。但是持久连接再需要请资源的时候就不需要建立新的TCP连接了

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020070301065437.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

持久连接的两种方式——非流水线和流水线
非流水线就是发一个，确认一个，才能再发下一个
流水线就是一个个连着发，然后多个确认
和之前说过的停止等待协议，后退N帧协议和选择重传协议很像，忘了的话可以去复习一下
开个传送门计算机网络笔记Part3 数据链路层（Data Link Layer）

##### 5.2.4 HTTP的报文结构

开始行用于区别请求报文和响应报文。可以明显的看到两者第一行的东西都不一样

请求报文的方法是指命令，就是对所请求的对象进行什么操作，如获取/删除等等
URL就是之间说的资源标识符
版本是指使用的是什么版本的HTTP协议

CRLF相当于我们程序里面的；，标识一行的结束。同时，在整个首部行结束时，为了区别首部行和实体主体还会有一行单独的CRLF

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703011608294.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

这里举了请求报文的例子，和一些常用的状态码

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703012144697.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 6. 本章思维导图

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200703012244338.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

















